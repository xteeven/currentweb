"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@mr-hope/vuepress-shared"),t=require("@vuepress/core"),a=require("@vuepress/utils");const r=new e.Logger("vuepress-plugin-seo2"),o=(e,t,a)=>`${e.match(/https?:\/\//)?"":"https://"}${e.replace(/\/$/u,"")}${t}${a.replace(/^\//u,"")}`,s=(t,{page:a,app:r,permalink:s})=>{var i;const{isArticle:n=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=t,{base:l}=r.options,{frontmatter:{author:c,time:p,date:g=p,banner:m,cover:u,tag:d,tags:h=d},git:f={}}=a,{siteData:$}=r,v=$.locales[a.pathLocale].title||$.title||$.locales["/"].title||"",w=!1===c?[]:e.getAuthor(c||t.author),{updatedTime:b}=f,y=b?new Date(b).toISOString():"",x=Array.isArray(h)?h:"string"==typeof d?[d]:[],O=a.title,S=u?o(t.hostname,l,u):m?o(t.hostname,l,m):"",D=((e,t)=>Object.entries(t).map((([,e])=>e.lang)).filter((t=>"string"==typeof t&&t!==e)))(a.lang,$.locales);let P="";if(g instanceof Date)P=new Date(g).toISOString();else if(g){const t=e.getDate(g);t&&t.value&&(P=t.value.toISOString())}return{OGP:{"og:url":o(t.hostname,l,s||a.path),"og:site_name":v,"og:title":O,"og:description":a.frontmatter.description||"","og:type":n(a)?"article":"website","og:image":S,"og:updated_time":y,"og:locale":a.lang,"og:locale:alternate":D,"twitter:card":"summary_large_image","twitter:image:alt":v,"article:author":null===(i=w[0])||void 0===i?void 0:i.name,"article:tag":x,"article:published_time":P,"article:modified_time":y},JSONLD:n(a)?{"@context":"https://schema.org","@type":"NewsArticle",headline:O,image:[S],datePublished:P,dateModified:y,author:w.map((e=>({"@type":"Person",...e})))}:null}},i=(e,{name:t,content:a,attribute:r=(["article:","og:"].some((e=>t.startsWith(e)))?"property":"name")})=>{a&&e.push(["meta",{[r]:t,content:a}])},n=o=>o.hostname?{name:"vuepress-plugin-seo2",extendsPage:(a,r)=>{var n;a.frontmatter.description||(a.frontmatter.summary=e.stripTags(a.excerpt)||(n=a.content,n?((e="")=>e.replace(/<\/?.+?\/?>/g,""))(n).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split("\n").map((e=>e.trim())).join("\n").replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"").slice(0,180)||"");const l=a.frontmatter.head||[],c={page:a,app:r,permalink:t.resolvePagePermalink(a)},{OGP:p,JSONLD:g}=s(o,c),m=o.ogp?o.ogp(p,c):p,u=o.jsonLd?o.jsonLd(g,c):null;((e,t,a)=>{for(const a in t)switch(a){case"article:tag":t["article:tag"].forEach((t=>i(e,{name:"article:tag",content:t})));break;case"og:locale:alternate":t["og:locale:alternate"].forEach((a=>{a!==t["og:locale"]&&i(e,{name:"og:locale:alternate",content:a})}));break;default:t[a]&&i(e,{name:a,content:t[a]})}a.restrictions&&i(e,{name:"og:restrictions:age",content:a.restrictions}),a.twitterID&&i(e,{name:"twitter:creator",content:a.twitterID})})(l,m,o),u&&l.push(["script",{type:"application/ld+json"},JSON.stringify(u)]),o.customHead&&o.customHead(l,c),a.frontmatter.head=l},onGenerated:e=>(async e=>{r.load("Generating robots.txt");const t=e.public("robots.txt");let o=a.fs.existsSync(t)?await a.fs.readFile(t,{encoding:"utf8"}):"";o&&!o.includes("User-agent")?(r.error(),r.update("robots.txt seems invalid!")):(o+="\nUser-agent:*\nDisallow:\n",await a.fs.writeFile(e.dest("robots.txt"),o,{flag:"w"}),r.succeed())})(e.dir)}:(r.error("Option 'hostname' is required!"),{name:"vuepress-plugin-seo2"});exports.default=n,exports.seo=e=>["seo2",e],exports.seoPlugin=n;
//# sourceMappingURL=index.js.map
